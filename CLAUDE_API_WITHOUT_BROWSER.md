# üöÄ Claude API –±–µ–∑ –±—Ä–∞—É–∑–µ—Ä–∞

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ Puppeteer:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Claude API | Puppeteer + Browser |
|----------|-----------|---------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° 1-3 —Å–µ–∫—É–Ω–¥—ã | üêå 10-30 —Å–µ–∫—É–Ω–¥ |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | ‚úÖ 99.9% uptime | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞ |
| **–†–µ—Å—É—Ä—Å—ã** | üíö –ú–∏–Ω–∏–º—É–º RAM/CPU | üî¥ –ú–Ω–æ–≥–æ RAM (500MB+) |
| **–£—Å—Ç–∞–Ω–æ–≤–∫–∞** | ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è Chrome | ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Chrome |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API | ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ UI |

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á Claude

**–°–ø–æ—Å–æ–± 1: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API (–ø–ª–∞—Ç–Ω—ã–π)**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://console.anthropic.com/
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.003 –∑–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤ –≤—Ö–æ–¥–∞, ~$0.015 –∑–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤ –≤—ã—Ö–æ–¥–∞

**–°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sessionKey –∫–∞–∫ API –∫–ª—é—á (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å sessionKey
- –§–æ—Ä–º–∞—Ç sessionKey: `sk-ant-sid01-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`

### 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ workflow

```bash
# URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ n8n:
https://raw.githubusercontent.com/ilya3211/n8n-workflow/claude/claude-n8n-automation-workflow-019ZyGaGbj3EVNbpj2hqt8ia/workflows/claude-api-direct.json
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ n8n UI:**
1. Workflows ‚Üí Import from URL
2. –í—Å—Ç–∞–≤—å—Ç–µ URL –≤—ã—à–µ
3. –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_CLAUDE_API_KEY_HERE` –Ω–∞ –≤–∞—à –∫–ª—é—á

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞

–í –Ω–æ–¥–µ **"Claude API Request"** –∑–∞–º–µ–Ω–∏—Ç–µ:
```json
{
  "name": "x-api-key",
  "value": "YOUR_CLAUDE_API_KEY_HERE"
}
```

–ù–∞:
```json
{
  "name": "x-api-key",
  "value": "sk-ant-api03-–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å"
}
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å

```javascript
// Input –¥–ª—è Manual Trigger:
{
  "prompt": "–ù–∞–ø–∏—à–∏ –º–Ω–µ —Å—Ç–∏—Ö –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤"
}

// Output:
{
  "response": "–°–∏–¥—è—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –≤ –Ω–æ—á–∏...",
  "model": "claude-3-5-sonnet-20241022",
  "usage_tokens": 156
}
```

### –ß–µ—Ä–µ–∑ HTTP Request (webhook)

–î–æ–±–∞–≤—å—Ç–µ **Webhook** –Ω–æ–¥—É –≤–º–µ—Å—Ç–æ Manual Trigger:

```bash
# POST –∑–∞–ø—Ä–æ—Å:
curl -X POST https://your-n8n.com/webhook/claude \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é —Ñ–∏–∑–∏–∫—É –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏"
  }'
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

```json
// –ü–æ—Å–ª–µ Telegram Trigger –¥–æ–±–∞–≤—å—Ç–µ Set –Ω–æ–¥—É:
{
  "prompt": "={{ $json.message.text }}"
}
// –ó–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ Claude API Request
```

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ | –¶–µ–Ω–∞ | –ú–∞–∫—Å —Ç–æ–∫–µ–Ω–æ–≤ |
|--------|----------|----------|------|--------------|
| `claude-3-5-sonnet-20241022` | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | $$ | 200K |
| `claude-3-5-haiku-20241022` | ‚ö°‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê | $ | 200K |
| `claude-3-opus-20240229` | ‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | $$$ | 200K |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** `claude-3-5-sonnet-20241022` - –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ

## üîß –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### System Prompt

```json
{
  "model": "claude-3-5-sonnet-20241022",
  "max_tokens": 4096,
  "system": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –Ω–∞ Python. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.",
  "messages": [
    {
      "role": "user",
      "content": "{{ $json.prompt }}"
    }
  ]
}
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–∞–º—è—Ç—å (multi-turn)

```json
{
  "messages": [
    {
      "role": "user",
      "content": "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ò–ª—å—è"
    },
    {
      "role": "assistant",
      "content": "–ü—Ä–∏–≤–µ—Ç, –ò–ª—å—è! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
    },
    {
      "role": "user",
      "content": "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"
    }
  ]
}
```

### Streaming (–ø–æ—Ç–æ–∫–æ–≤—ã–π –≤—ã–≤–æ–¥)

```json
{
  "url": "https://api.anthropic.com/v1/messages",
  "method": "POST",
  "headers": {
    "x-api-key": "your-key",
    "anthropic-version": "2023-06-01"
  },
  "body": {
    "model": "claude-3-5-sonnet-20241022",
    "max_tokens": 4096,
    "stream": true,
    "messages": [...]
  }
}
```

### Temperature (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)

```json
{
  "temperature": 0.0,  // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ª–æ–≥–∏—á–Ω—ã–π (–¥–ª—è –∫–æ–¥–∞)
  "temperature": 0.7,  // –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  "temperature": 1.0   // –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π (–¥–ª—è —Å—Ç–∏—Ö–æ–≤, –∏–¥–µ–π)
}
```

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: API vs Browser Automation

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API:
‚úÖ –ù—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
‚úÖ –ü—Ä–æ–¥–∞–∫—à–Ω-—Ä–µ—à–µ–Ω–∏—è
‚úÖ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (100+ –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å)
‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚úÖ –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Chrome

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Browser (Puppeteer):
‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å sessionKey, –Ω–æ –Ω–µ—Ç API –∫–ª—é—á–∞
‚úÖ –ù—É–∂–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º Claude
‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI
‚úÖ –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üí° –ü—Ä–∏–º–µ—Ä—ã use cases

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–¥-—Ä–µ–≤—å—é–µ—Ä

```javascript
// Git webhook ‚Üí n8n ‚Üí Claude API
{
  "prompt": `–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è:

${gitDiff}

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
- –ü—Ä–æ–±–ª–µ–º—ã: ...
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: ...
- –û—Ü–µ–Ω–∫–∞: X/10`
}
```

### 2. Telegram –±–æ—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

```
User ‚Üí Telegram ‚Üí n8n Webhook ‚Üí Claude API ‚Üí Telegram
```

### 3. Email –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫

```javascript
// Email trigger ‚Üí Claude API ‚Üí Send Email
{
  "system": "–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –û—Ç–≤–µ—á–∞–π –≤–µ–∂–ª–∏–≤–æ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ.",
  "prompt": "–û—Ç–≤–µ—Ç—å –Ω–∞ —ç—Ç–æ—Ç email:\n\n{{ $json.emailBody }}"
}
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```javascript
// Schedule trigger (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å) ‚Üí Claude API ‚Üí Post to social media
{
  "prompt": "–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç –¥–ª—è LinkedIn –ø—Ä–æ AI –≤ –±–∏–∑–Ω–µ—Å–µ. 200 —Å–∏–º–≤–æ–ª–æ–≤, —Å —ç–º–æ–¥–∑–∏."
}
```

### 5. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

```javascript
// Database trigger ‚Üí Claude API ‚Üí Dashboard
{
  "prompt": `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂ –∏ –¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

${JSON.stringify(salesData, null, 2)}

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "trend": "—Ä–∞—Å—Ç–µ—Ç/–ø–∞–¥–∞–µ—Ç",
  "insights": [...],
  "recommendations": [...]
}`
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

**–°–ø–æ—Å–æ–± 1: Environment Variables (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# .env —Ñ–∞–π–ª:
CLAUDE_API_KEY=sk-ant-api03-xxxxx

# –í n8n –Ω–æ–¥–µ:
"value": "={{ $env.CLAUDE_API_KEY }}"
```

**–°–ø–æ—Å–æ–± 2: n8n Credentials**
1. Settings ‚Üí Credentials ‚Üí Create New
2. Type: Header Auth
3. Name: `x-api-key`
4. Value: –≤–∞—à –∫–ª—é—á

### Rate Limits

| –¢–∞—Ä–∏—Ñ | –ó–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω | –¢–æ–∫–µ–Ω–æ–≤/–º–∏–Ω | –¢–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å |
|-------|--------------|-------------|--------------|
| Free tier | 5 | 20,000 | 100,000 |
| Tier 1 | 50 | 40,000 | 300,000 |
| Tier 2 | 100 | 80,000 | 600,000 |
| Tier 3 | 200 | 160,000 | 1,200,000 |

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ rate limit:**
```json
{
  "retry": {
    "maxTries": 3,
    "waitTime": 2000,
    "backoffStrategy": "exponential"
  }
}
```

## üêõ Troubleshooting

### Error: Invalid API key
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞: –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "sk-ant-api03-"
```

### Error: 429 Too Many Requests
```
–ü—Ä–µ–≤—ã—à–µ–Ω rate limit. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏–ª–∏ –ø–æ–≤—ã—Å—å—Ç–µ —Ç–∞—Ä–∏—Ñ.
```

### Error: 400 Bad Request
```json
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JSON body:
{
  "model": "claude-3-5-sonnet-20241022",  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –º–æ–¥–µ–ª–∏
  "max_tokens": 4096,                     // ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
  "messages": [...]                       // ‚úÖ –ù–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
}
```

### Error: Timeout
```javascript
// –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ HTTP Request –Ω–æ–¥–µ:
{
  "timeout": 60000  // 60 —Å–µ–∫—É–Ω–¥
}
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
// Code node –ø–æ—Å–ª–µ Claude API:
const response = $input.first().json;

// –õ–æ–≥–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫–∏
console.log('Tokens used:', response.usage.input_tokens + response.usage.output_tokens);
console.log('Response time:', Date.now() - startTime);

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
return {
  timestamp: new Date(),
  tokens: response.usage,
  cost: calculateCost(response.usage),
  response: response.content[0].text
};
```

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Claude API](https://docs.anthropic.com/claude/reference/)
- [–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤](https://docs.anthropic.com/claude/docs/prompt-engineering)
- [Pricing –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä](https://www.anthropic.com/pricing)
- [Discord —Å–æ–æ–±—â–µ—Å—Ç–≤–æ](https://discord.gg/anthropic)

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

- [ ] –ü–æ–ª—É—á–µ–Ω API –∫–ª—é—á –æ—Ç Claude
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω workflow –≤ n8n
- [ ] API –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ HTTP Request –Ω–æ–¥—É
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω error handling
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –±—ã—Å—Ç—Ä–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude –ë–ï–ó –±—Ä–∞—É–∑–µ—Ä–∞! üöÄ**
