{
  "name": "Extract Sitekey Browserless v2 (Fixed)",
  "nodes": [
    {
      "parameters": {},
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "targetURL",
              "name": "targetURL",
              "value": "https://claude.ai/new",
              "type": "string"
            },
            {
              "id": "waitTime",
              "name": "waitTime",
              "value": 5000,
              "type": "number"
            }
          ]
        }
      },
      "name": "‚öôÔ∏è Settings",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [460, 300],
      "id": "settings",
      "notes": "–ò–∑–º–µ–Ω–∏—Ç–µ targetURL –Ω–∞ –Ω—É–∂–Ω—ã–π —Å–∞–π—Ç"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://production-sfo.browserless.io/content?token=2TRkln4qk0YySXg802f0c9d35a14b6e4fdedbdc9bff4edaac",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  url: $json.targetURL,\n  waitForTimeout: $json.waitTime,\n  gotoOptions: {\n    waitUntil: 'networkidle2'\n  }\n}) }}",
        "options": {
          "timeout": 60000
        }
      },
      "name": "üåê Get Page Content",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300],
      "id": "content",
      "notes": "–ü–æ–ª—É—á–∞–µ—Ç HTML –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã"
    },
    {
      "parameters": {
        "jsCode": "const html = $input.item.json;\nlet htmlContent = '';\n\nif (typeof html === 'string') {\n  htmlContent = html;\n} else if (html.body) {\n  htmlContent = html.body;\n} else {\n  htmlContent = JSON.stringify(html);\n}\n\nconst result = {\n  success: false,\n  url: $('‚öôÔ∏è Settings').item.json.targetURL,\n  timestamp: new Date().toISOString(),\n  captchaType: 'not_found',\n  sitekey: null,\n  searchMethods: []\n};\n\n// –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ data-sitekey –∞—Ç—Ä–∏–±—É—Ç–∞\nconst dataSitekeyMatch = htmlContent.match(/data-sitekey=[\"']([0-9a-zA-Z_-]{10,100})[\"']/);\nif (dataSitekeyMatch && dataSitekeyMatch[1]) {\n  result.success = true;\n  result.captchaType = 'standalone';\n  result.sitekey = dataSitekeyMatch[1];\n  result.searchMethods.push('‚úÖ data-sitekey attribute');\n  return result;\n}\nresult.searchMethods.push('‚ùå data-sitekey not found');\n\n// –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ sitekey –≤ –æ–±—ä–µ–∫—Ç–∞—Ö\nconst sitekeyPropMatch = htmlContent.match(/[\"']sitekey[\"']\\s*:\\s*[\"']([0-9a-zA-Z_-]{10,100})[\"']/);\nif (sitekeyPropMatch && sitekeyPropMatch[1]) {\n  result.success = true;\n  result.captchaType = 'standalone';\n  result.sitekey = sitekeyPropMatch[1];\n  result.searchMethods.push('‚úÖ sitekey property');\n  return result;\n}\nresult.searchMethods.push('‚ùå sitekey property not found');\n\n// –ú–µ—Ç–æ–¥ 3: –ü–æ–∏—Å–∫ –≤ iframe src\nconst iframeSrcMatch = htmlContent.match(/src=[\"']([^\"']*challenges\\.cloudflare\\.com[^\"']*)[\"]/);\nif (iframeSrcMatch && iframeSrcMatch[1]) {\n  const sitekeyFromIframe = iframeSrcMatch[1].match(/[?&]sitekey=([^&\"']+)/);\n  if (sitekeyFromIframe && sitekeyFromIframe[1]) {\n    result.success = true;\n    result.captchaType = 'standalone_iframe';\n    result.sitekey = sitekeyFromIframe[1];\n    result.searchMethods.push('‚úÖ iframe src');\n    return result;\n  }\n}\nresult.searchMethods.push('‚ùå iframe src not found');\n\n// –ú–µ—Ç–æ–¥ 4: –ü–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 0x...\nconst oxPatternMatch = htmlContent.match(/[\"'](0x[0-9a-zA-Z_-]{10,100})[\"']/);\nif (oxPatternMatch && oxPatternMatch[1]) {\n  result.success = true;\n  result.captchaType = 'html_extraction';\n  result.sitekey = oxPatternMatch[1];\n  result.searchMethods.push('‚úÖ 0x pattern');\n  return result;\n}\nresult.searchMethods.push('‚ùå 0x pattern not found');\n\nresult.error = 'Cloudflare Turnstile sitekey not found';\nresult.suggestion = 'Try increasing waitTime or check if page uses Turnstile';\n\nreturn result;"
      },
      "name": "üîç Extract Sitekey from HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300],
      "id": "extract",
      "notes": "–ò–∑–≤–ª–µ–∫–∞–µ—Ç sitekey –∏–∑ HTML –∫–æ–¥–∞"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "‚úÖ success",
              "value": "={{ $json.success }}",
              "type": "boolean"
            },
            {
              "id": "sitekey",
              "name": "üîë websiteKey",
              "value": "={{ $json.sitekey }}",
              "type": "string"
            },
            {
              "id": "url",
              "name": "üåê websiteURL",
              "value": "={{ $json.url }}",
              "type": "string"
            },
            {
              "id": "type",
              "name": "üìã captchaType",
              "value": "={{ $json.captchaType }}",
              "type": "string"
            },
            {
              "id": "methods",
              "name": "üîç searchMethods",
              "value": "={{ JSON.stringify($json.searchMethods, null, 2) }}",
              "type": "string"
            },
            {
              "id": "rucaptcha",
              "name": "ü§ñ RuCaptcha Payload",
              "value": "={{ $json.success ? JSON.stringify({\n  clientKey: 'YOUR_RUCAPTCHA_API_KEY',\n  task: {\n    type: 'TurnstileTaskProxyless',\n    websiteURL: $json.url,\n    websiteKey: $json.sitekey\n  }\n}, null, 2) : 'N/A - Sitekey not found' }}",
              "type": "string"
            },
            {
              "id": "error",
              "name": "‚ùå error",
              "value": "={{ $json.error || null }}",
              "type": "string"
            },
            {
              "id": "suggestion",
              "name": "üí° suggestion",
              "value": "={{ $json.suggestion || null }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "‚è∞ timestamp",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            }
          ]
        }
      },
      "name": "üìä Final Result",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1120, 300],
      "id": "result"
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [[{"node": "‚öôÔ∏è Settings", "type": "main", "index": 0}]]
    },
    "‚öôÔ∏è Settings": {
      "main": [[{"node": "üåê Get Page Content", "type": "main", "index": 0}]]
    },
    "üåê Get Page Content": {
      "main": [[{"node": "üîç Extract Sitekey from HTML", "type": "main", "index": 0}]]
    },
    "üîç Extract Sitekey from HTML": {
      "main": [[{"node": "üìä Final Result", "type": "main", "index": 0}]]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["browserless", "turnstile", "sitekey", "simple"],
  "triggerCount": 0,
  "updatedAt": "2025-11-18T18:30:00.000Z",
  "versionId": ""
}
