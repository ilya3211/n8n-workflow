{
  "name": "Claude.AI Puppeteer - FULL VERSION (Ready)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "claude-automation",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        240,
        300
      ],
      "webhookId": "claude-automation-webhook",
      "id": "a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d"
    },
    {
      "parameters": {},
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        240,
        460
      ],
      "id": "b2c3d4e5-f6a7-4b5c-8d9e-0f1a2b3c4d5e"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ========================================\n// CREDENTIALS - –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∑–¥–µ—Å—å:\n// ========================================\nconst SESSION_KEY = 'YOUR_SESSION_KEY_HERE';\nconst CF_BM_COOKIE = 'YOUR_CF_BM_COOKIE_HERE';\n// ========================================\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ webhook –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π)\nconst userPrompt = $input.first().json.body?.prompt \n  || $input.first().json.prompt \n  || '–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –∫–æ—Ä–æ—Ç–∫—É—é —à—É—Ç–∫—É –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤';\n\nconst timeout = $input.first().json.body?.timeout \n  || $input.first().json.timeout \n  || 60000;\n\n// –ò–º–ø–æ—Ä—Ç Puppeteer\nconst puppeteer = require('puppeteer');\n\nlet browser;\ntry {\n  console.log('üöÄ –ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞...');\n  \n  // –ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞\n  browser = await puppeteer.launch({\n    headless: true,\n    args: [\n      '--no-sandbox',\n      '--disable-setuid-sandbox',\n      '--disable-dev-shm-usage',\n      '--disable-gpu',\n      '--disable-web-security'\n    ]\n  });\n\n  const page = await browser.newPage();\n  \n  console.log('üîê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–æ–≤...');\n  \n  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–æ–≤ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\n  await page.setCookie(\n    {\n      name: 'sessionKey',\n      value: SESSION_KEY,\n      domain: '.claude.ai',\n      path: '/',\n      httpOnly: true,\n      secure: true,\n      sameSite: 'None'\n    },\n    {\n      name: '__cf_bm',\n      value: CF_BM_COOKIE,\n      domain: '.claude.ai',\n      path: '/',\n      httpOnly: true,\n      secure: true,\n      sameSite: 'None'\n    }\n  );\n\n  console.log('‚úÖ –ö—É–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');\n  console.log('üåê –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ claude.ai...');\n\n  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Claude\n  await page.goto('https://claude.ai/new', {\n    waitUntil: 'networkidle2',\n    timeout: 30000\n  });\n\n  console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');\n  console.log('üîç –ü–æ–∏—Å–∫ –ø–æ–ª—è –≤–≤–æ–¥–∞...');\n\n  // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–∞—Ç–∞\n  await page.waitForSelector('div[contenteditable=\"true\"]', {\n    timeout: 10000\n  });\n\n  console.log('‚úÖ –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–∞–π–¥–µ–Ω–æ');\n  console.log('‚å®Ô∏è  –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞:', userPrompt.substring(0, 50) + '...');\n\n  // –ö–ª–∏–∫ –ø–æ –ø–æ–ª—é –≤–≤–æ–¥–∞ –∏ –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞\n  await page.click('div[contenteditable=\"true\"]');\n  await page.type('div[contenteditable=\"true\"]', userPrompt, {\n    delay: 50\n  });\n\n  console.log('‚úÖ –¢–µ–∫—Å—Ç –≤–≤–µ–¥–µ–Ω');\n  console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è...');\n\n  // –ü–æ–∏—Å–∫ –∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏\n  await page.waitForSelector('button[aria-label=\"Send Message\"], button[type=\"submit\"]', {\n    timeout: 5000\n  });\n  await page.click('button[aria-label=\"Send Message\"], button[type=\"submit\"]');\n\n  console.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');\n  console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ Claude...');\n\n  // –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞\n  await page.waitForFunction(\n    () => {\n      const messages = document.querySelectorAll('[data-testid=\"message\"]');\n      return messages.length >= 2;\n    },\n    { timeout: timeout }\n  );\n\n  console.log('‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω');\n  console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...');\n\n  // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏\n  await page.waitForFunction(\n    () => {\n      const stopButton = document.querySelector('button[aria-label=\"Stop generating\"]');\n      return !stopButton || stopButton.disabled;\n    },\n    { timeout: 120000 }\n  );\n\n  console.log('‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\n  console.log('üìù –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞...');\n\n  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n  const response = await page.evaluate(() => {\n    const messages = document.querySelectorAll('[data-testid=\"message\"]');\n    if (messages.length < 2) return null;\n\n    const lastMessage = messages[messages.length - 1];\n    return lastMessage.innerText || lastMessage.textContent;\n  });\n\n  console.log('‚úÖ –û—Ç–≤–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω:', response ? response.substring(0, 100) + '...' : 'null');\n\n  // –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞\n  await browser.close();\n  console.log('üèÅ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç');\n\n  // –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\n  return [\n    {\n      json: {\n        success: true,\n        prompt: userPrompt,\n        response: response,\n        timestamp: new Date().toISOString(),\n        responseLength: response ? response.length : 0,\n        executionTime: 'See workflow execution time',\n        credentialsUsed: {\n          sessionKey: SESSION_KEY.substring(0, 20) + '...',\n          cfBmCookie: CF_BM_COOKIE.substring(0, 20) + '...'\n        }\n      }\n    }\n  ];\n\n} catch (error) {\n  console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);\n  console.error('Stack:', error.stack);\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n  let screenshot = null;\n  let debugUrl = '';\n  let debugTitle = '';\n  \n  try {\n    if (browser) {\n      const pages = await browser.pages();\n      if (pages.length > 0) {\n        const page = pages[0];\n        screenshot = await page.screenshot({\n          encoding: 'base64',\n          fullPage: true\n        });\n        debugUrl = await page.url();\n        debugTitle = await page.title();\n      }\n    }\n  } catch (screenshotError) {\n    console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç:', screenshotError.message);\n  }\n\n  // –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ\n  if (browser) {\n    try {\n      await browser.close();\n      console.log('üèÅ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç (–ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏)');\n    } catch (closeError) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞:', closeError.message);\n    }\n  }\n\n  // –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏\n  return [\n    {\n      json: {\n        success: false,\n        error: error.message,\n        errorStack: error.stack,\n        timestamp: new Date().toISOString(),\n        screenshot: screenshot,\n        debugInfo: {\n          url: debugUrl,\n          title: debugTitle\n        },\n        help: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: 1) –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∫—É–∫–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –∫–æ–¥–∞, 2) –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å claude.ai, 3) –°–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ –∫–æ–¥–µ'\n      }\n    }\n  ];\n}"
      },
      "name": "Claude AI Automation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        300
      ],
      "id": "c3d4e5f6-a7b8-4c5d-8e9f-0a1b2c3d4e5f"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "success_check",
              "leftValue": "={{ $json.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "Check Success",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        680,
        300
      ],
      "id": "d4e5f6a7-b8c9-4d5e-8f9a-0b1c2d3e4f5a"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "success",
              "value": "={{ $json.success }}",
              "type": "boolean"
            },
            {
              "id": "prompt",
              "name": "prompt",
              "value": "={{ $json.prompt }}",
              "type": "string"
            },
            {
              "id": "response",
              "name": "claudeResponse",
              "value": "={{ $json.response }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "timestamp",
              "value": "={{ $json.timestamp }}",
              "type": "string"
            },
            {
              "id": "response_length",
              "name": "responseLength",
              "value": "={{ $json.responseLength }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "name": "Format Success",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        900,
        200
      ],
      "id": "e5f6a7b8-c9d0-4e5f-8a9b-0c1d2e3f4a5b"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "success",
              "value": false,
              "type": "boolean"
            },
            {
              "id": "error",
              "name": "error",
              "value": "={{ $json.error }}",
              "type": "string"
            },
            {
              "id": "screenshot",
              "name": "screenshot",
              "value": "={{ $json.screenshot }}",
              "type": "string"
            },
            {
              "id": "help",
              "name": "help",
              "value": "={{ $json.help }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "name": "Format Error",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        900,
        400
      ],
      "id": "f6a7b8c9-d0e1-4f5a-8b9c-0d1e2f3a4b5c"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1120,
        300
      ],
      "id": "a7b8c9d0-e1f2-4a5b-8c9d-0e1f2a3b4c5d"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Claude AI Automation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Claude AI Automation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude AI Automation": {
      "main": [
        [
          {
            "node": "Check Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Success": {
      "main": [
        [
          {
            "node": "Format Success",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Success": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Error": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-15T14:30:00.000Z",
  "versionId": ""
}
