{
  "name": "Extract Cloudflare Turnstile Sitekey (Corrected)",
  "nodes": [
    {
      "parameters": {},
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "targetURL",
              "name": "targetURL",
              "value": "https://claude.ai/new",
              "type": "string"
            },
            {
              "id": "waitTime",
              "name": "waitTime",
              "value": 5000,
              "type": "number"
            }
          ]
        }
      },
      "name": "‚öôÔ∏è Settings",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [460, 300],
      "id": "settings",
      "notes": "Change targetURL to your target website"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://production-sfo.browserless.io/content?token=2TRkln4qk0YySXg802f0c9d35a14b6e4fdedbdc9bff4edaac",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"url\": $json.targetURL, \"waitForTimeout\": $json.waitTime, \"gotoOptions\": { \"waitUntil\": \"networkidle2\" } } }}",
        "options": {
          "timeout": 60000
        }
      },
      "name": "üåê Get Page HTML",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300],
      "id": "content",
      "notes": "Gets HTML content via Browserless.io"
    },
    {
      "parameters": {
        "jsCode": "// Get HTML content\nconst html = $input.item.json;\nconst targetURL = $('‚öôÔ∏è Settings').item.json.targetURL;\n\nlet htmlContent = '';\n\n// Handle different response formats\nif (typeof html === 'string') {\n  htmlContent = html;\n} else if (html && html.body) {\n  htmlContent = html.body;\n} else if (html && typeof html === 'object') {\n  htmlContent = JSON.stringify(html);\n} else {\n  htmlContent = String(html);\n}\n\n// Result object\nconst result = {\n  success: false,\n  websiteURL: targetURL,\n  timestamp: new Date().toISOString(),\n  captchaType: 'not_found',\n  websiteKey: null,\n  searchMethods: [],\n  htmlLength: htmlContent.length\n};\n\n// Method 1: data-sitekey attribute\ntry {\n  const match1 = htmlContent.match(/data-sitekey\\s*=\\s*[\"']([0-9a-zA-Z_-]{10,100})[\"']/);\n  if (match1 && match1[1]) {\n    result.success = true;\n    result.captchaType = 'standalone';\n    result.websiteKey = match1[1];\n    result.searchMethods.push('‚úÖ data-sitekey attribute');\n    result.rucaptchaPayload = {\n      clientKey: 'YOUR_RUCAPTCHA_API_KEY',\n      task: {\n        type: 'TurnstileTaskProxyless',\n        websiteURL: targetURL,\n        websiteKey: match1[1]\n      }\n    };\n    return result;\n  }\n  result.searchMethods.push('‚ùå data-sitekey attribute - not found');\n} catch (e) {\n  result.searchMethods.push('‚ö†Ô∏è data-sitekey - error: ' + e.message);\n}\n\n// Method 2: sitekey property in JS objects\ntry {\n  const match2 = htmlContent.match(/[\"']sitekey[\"']\\s*:\\s*[\"']([0-9a-zA-Z_-]{10,100})[\"']/);\n  if (match2 && match2[1]) {\n    result.success = true;\n    result.captchaType = 'standalone';\n    result.websiteKey = match2[1];\n    result.searchMethods.push('‚úÖ sitekey property');\n    result.rucaptchaPayload = {\n      clientKey: 'YOUR_RUCAPTCHA_API_KEY',\n      task: {\n        type: 'TurnstileTaskProxyless',\n        websiteURL: targetURL,\n        websiteKey: match2[1]\n      }\n    };\n    return result;\n  }\n  result.searchMethods.push('‚ùå sitekey property - not found');\n} catch (e) {\n  result.searchMethods.push('‚ö†Ô∏è sitekey property - error: ' + e.message);\n}\n\n// Method 3: iframe src with challenges.cloudflare.com\ntry {\n  const match3 = htmlContent.match(/src\\s*=\\s*[\"']([^\"']*challenges\\.cloudflare\\.com[^\"']*)[\"']/);\n  if (match3 && match3[1]) {\n    const sitekeyFromIframe = match3[1].match(/[?&]sitekey=([^&\"']+)/);\n    if (sitekeyFromIframe && sitekeyFromIframe[1]) {\n      result.success = true;\n      result.captchaType = 'standalone_iframe';\n      result.websiteKey = sitekeyFromIframe[1];\n      result.searchMethods.push('‚úÖ iframe src');\n      result.rucaptchaPayload = {\n        clientKey: 'YOUR_RUCAPTCHA_API_KEY',\n        task: {\n          type: 'TurnstileTaskProxyless',\n          websiteURL: targetURL,\n          websiteKey: sitekeyFromIframe[1]\n        }\n      };\n      return result;\n    }\n  }\n  result.searchMethods.push('‚ùå iframe src - not found');\n} catch (e) {\n  result.searchMethods.push('‚ö†Ô∏è iframe src - error: ' + e.message);\n}\n\n// Method 4: 0x pattern (characteristic of Cloudflare)\ntry {\n  const match4 = htmlContent.match(/[\"'](0x[0-9a-zA-Z_-]{10,100})[\"']/);\n  if (match4 && match4[1]) {\n    result.success = true;\n    result.captchaType = 'html_extraction';\n    result.websiteKey = match4[1];\n    result.searchMethods.push('‚úÖ 0x pattern');\n    result.rucaptchaPayload = {\n      clientKey: 'YOUR_RUCAPTCHA_API_KEY',\n      task: {\n        type: 'TurnstileTaskProxyless',\n        websiteURL: targetURL,\n        websiteKey: match4[1]\n      }\n    };\n    return result;\n  }\n  result.searchMethods.push('‚ùå 0x pattern - not found');\n} catch (e) {\n  result.searchMethods.push('‚ö†Ô∏è 0x pattern - error: ' + e.message);\n}\n\n// Nothing found\nresult.error = 'Cloudflare Turnstile sitekey not found on page';\nresult.suggestion = 'Try increasing waitTime or check if the page actually uses Turnstile';\n\nreturn result;"
      },
      "name": "üîç Extract Sitekey",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300],
      "id": "extract",
      "notes": "Extracts sitekey from HTML using 4 methods"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success",
              "name": "‚úÖ success",
              "value": "={{ $json.success }}",
              "type": "boolean"
            },
            {
              "id": "websiteKey",
              "name": "üîë websiteKey",
              "value": "={{ $json.websiteKey }}",
              "type": "string"
            },
            {
              "id": "websiteURL",
              "name": "üåê websiteURL",
              "value": "={{ $json.websiteURL }}",
              "type": "string"
            },
            {
              "id": "captchaType",
              "name": "üìã captchaType",
              "value": "={{ $json.captchaType }}",
              "type": "string"
            },
            {
              "id": "searchMethods",
              "name": "üîç searchMethods",
              "value": "={{ JSON.stringify($json.searchMethods, null, 2) }}",
              "type": "string"
            },
            {
              "id": "rucaptchaPayload",
              "name": "ü§ñ RuCaptcha Payload",
              "value": "={{ $json.rucaptchaPayload ? JSON.stringify($json.rucaptchaPayload, null, 2) : 'N/A - Sitekey not found' }}",
              "type": "string"
            },
            {
              "id": "error",
              "name": "‚ùå error",
              "value": "={{ $json.error || null }}",
              "type": "string"
            },
            {
              "id": "suggestion",
              "name": "üí° suggestion",
              "value": "={{ $json.suggestion || null }}",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "‚è∞ timestamp",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            }
          ]
        }
      },
      "name": "üìä Final Result",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [1120, 300],
      "id": "result",
      "notes": "Formatted result with sitekey and RuCaptcha payload"
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [[{"node": "‚öôÔ∏è Settings", "type": "main", "index": 0}]]
    },
    "‚öôÔ∏è Settings": {
      "main": [[{"node": "üåê Get Page HTML", "type": "main", "index": 0}]]
    },
    "üåê Get Page HTML": {
      "main": [[{"node": "üîç Extract Sitekey", "type": "main", "index": 0}]]
    },
    "üîç Extract Sitekey": {
      "main": [[{"node": "üìä Final Result", "type": "main", "index": 0}]]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["browserless", "turnstile", "cloudflare", "working", "corrected"],
  "triggerCount": 0,
  "updatedAt": "2025-11-18T19:00:00.000Z",
  "versionId": ""
}
